<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html lang="ja">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta http-equiv="mded-output-date" content="2020/03/14 13:19:48">
<title>2003-express-ejs-bootstrap-site-template.md</title>
<META http-equiv="Content-Style-Type" content="text/css">
<style type="text/css"><!--
body {
color: #000000;
background-color: #FFFFFF;
font-family: ＭＳ ゴシック;
font-size: 11pt;
}
h1 {
background-color: #80FFFF;
font-size: 200%;
border-left: 3pt #8080FF solid;
}
h2 {
background-color: #C6FFFF;
font-size: 120%;
border-left: 2pt #8080FF solid;
}
h3 {
font-size: 100%;
border-bottom: 1pt #0000A0 solid;
}
h4 {
font-size: 100%;
}
h5 {
font-size: 100%;
}
h6 {
font-size: 100%;
}
blockquote p,blockquote ol,blockquote ul,blockquote li {
background-color: #FFFF80;
}
blockquote {
background-color: #FFFF80;
}
pre {
background-color: #EFEFEF;
font-family: Consolas;
}
dt {
color: #FFFFFF;
background-color: #000080;
}
dd {
background-color: #FAFAFA;
}
th {
padding:0.3em;
border: 1px #000000 solid;
}
td {
padding:0.3em;
border: 1px #000000 solid;
}
table.markdown {
background-color: #F0FBFB;
border: 1px #000000 solid;
table-layout: auto;
border-collapse: collapse;
border-spacing: 0;
empty-cells: show;
}
a {
color: #FFFFFF;
background-color: #800000;
}
code {
background-color: #80FF80;
}
--></style>
</head>
<body>
<div class="markdown-content"><a name="toc-top"></a>
<a name="toc-1"></a><h1>2003-express-ejs-bootstrap-site-template-01 :</h1>

<a name="toc-1-1"></a><h2>overview :</h2>
<ul><li>create a express project with ejs template.
<li>set index.html from bootstrap template site.
<li>modify site pages with bootstrap template using ejs template engine.
</ul>
<a name="toc-1-2"></a><h2>environment :</h2>
<pre>PS G:\workspace\nodejs&gt; nvm list

<li>  * 13.8.0 (Currently using 64-bit executable)
    12.14.1
    8.17.0
PS G:\workspace\nodejs&gt; node --version
v13.8.0
PS G:\workspace\nodejs&gt; express --version
4.16.1
</pre>

<a name="toc-1-3"></a><h2>express-generator :</h2>
<a name="toc-1-3-1"></a><h3>express --view ejs --git \<project site name\> &nbsp;:</h3>

<pre>PS G:\workspace\nodejs&gt; express --view ejs --git ejsboots

   create : ejsboots\
   create : ejsboots\public\
   create : ejsboots\public\javascripts\
   create : ejsboots\public\images\
   create : ejsboots\public\stylesheets\
   create : ejsboots\public\stylesheets\style.css
   create : ejsboots\routes\
   create : ejsboots\routes\index.js
   create : ejsboots\routes\users.js
   create : ejsboots\views\
   create : ejsboots\views\error.ejs
   create : ejsboots\views\index.ejs
   create : ejsboots\.gitignore
   create : ejsboots\app.js
   create : ejsboots\package.json
   create : ejsboots\bin\
   create : ejsboots\bin\www

   change directory:
     &gt; cd ejsboots

   install dependencies:
     &gt; npm install

   run the app:
     &gt; SET DEBUG=ejsboots:* &amp; npm start
</pre>

<a name="toc-1-3-2"></a><h3>npm install and npm start :</h3>
<pre>PS G:\workspace\nodejs&gt; cd .\ejsboots\
PS G:\workspace\nodejs\ejsboots&gt; npm install
npm notice created a lockfile as package-lock.json. You should commit this file.
added 53 packages from 38 contributors and audited 141 packages in 10.219s
found 0 vulnerabilities

PS G:\workspace\nodejs\ejsboots&gt; npm start

&gt; ejsboots@0.0.0 start G:\workspace\nodejs\ejsboots
&gt; node ./bin/www

GET / 200 23.887 ms - 207
GET /stylesheets/style.css 200 7.061 ms - 111
GET /favicon.ico 404 3.828 ms - 983
</pre>

<p><img src="https://gyazo.com/17de3c53c5fb7a7caae15f70d51f2e42.png" alt="image">
</p><br>

<a name="toc-1-3-3"></a><h3>code structure generated :</h3>

<pre>G:.
│  .gitignore
│  app.js
│  package-lock.json
│  package.json
│  
├─bin
│      www
│      
├─node_modules
│  
├─public
│  ├─images
│  ├─javascripts
│  └─stylesheets
│          style.css
│          
├─routes
│      index.js
│      users.js
│      
└─views
        error.ejs
        index.ejs

</pre>

<table class="markdown"><thead><th class="row"><th class="row">no<th class="row"> name &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<th class="row"> description &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<tr>
</thead><tbody><td class="clm1"><td class="clm2"> 1<td class="clm3"> app.js &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<td class="clm4"> server app &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<tr>
<td class="clm1"><td class="clm2"> 2<td class="clm3"> bin/wwww &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<td class="clm4"> kick command &nbsp;&nbsp;&nbsp;&nbsp;<tr>
<td class="clm1"><td class="clm2"> 3<td class="clm3"> router/index.js <td class="clm4"> index router &nbsp;&nbsp;&nbsp;&nbsp;<tr>
<td class="clm1"><td class="clm2"> 4<td class="clm3"> router/users.js <td class="clm4"> users router &nbsp;&nbsp;&nbsp;&nbsp;<tr>
<td class="clm1"><td class="clm2"> 5<td class="clm3"> views/index.ejs <td class="clm4"> index view &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<tr>
<td class="clm1"><td class="clm2"> 6<td class="clm3"> views/users.ejs <td class="clm4"> users view &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<tr>
<td class="clm1"><td class="clm2"> 7<td class="clm3"> public &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<td class="clm4"> www root folder(public) <tr>
</tbody></table>
<a name="toc-1-4"></a><h2>bootstrap sample template :</h2>
<a name="toc-1-4-4"></a><h3>download :</h3>
<ul><li>start bootstrap
<li>https://startbootstrap.com/
<ul><li>https://startbootstrap.com/previews/simple-sidebar/
</ul></ul>
<p><img src="https://gyazo.com/a67d8b943cb28260c83de1ced9973e63.png" alt="image">
</p>
<a name="toc-1-4-5"></a><h3>procedure :</h3>
<ol><ol><li>download zip
<li>exract zip
<li>deplaoy them express public root folder
<li>rename index.html to bssapmle.html
</ol></ol>
<a name="toc-1-4-6"></a><h3>confirmation :</h3>
<ul><li>access http://localhost:3000/bssample.html
</ul>
<p><img src="https://gyazo.com/379791cf4cdd7d4cc143c2da7880bbdc.png" alt="image">
</p>
<a name="toc-1-5"></a><h2>modify template into ejs layout and contents :</h2>

<a name="toc-1-5-7"></a><h3>libraries :</h3>
<ul><li>ejs
<li>https://ejs.co/
<li>express-ejs-layouts
<li>https://www.npmjs.com/package/express-ejs-layouts
</ul>
<a name="toc-1-5-8"></a><h3>references :</h3>
<ul><li>ejs
<li>https://qiita.com/y_hokkey/items/31f1daa6cecb5f4ea4c9
<li>express-ejs-layouts
<li>https://qiita.com/hiroakiprog/items/4d56277cd12c1917cdf6
<li>https://qiita.com/kanye__east/items/87172e946471b9c71cfa
</ul>
<a name="toc-1-5-9"></a><h3>usages of ejs and express-ejs-layouts &nbsp;:</h3>

<a name="toc-1-5-9-1"></a><h4>ejs tags :</h4>
<table class="markdown"><thead><th class="row"><th class="row">tag &nbsp;&nbsp;&nbsp;<th class="row"> description &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<tr>
</thead><tbody><td class="clm1"><td class="clm2"> &lt;% &nbsp;&nbsp;&nbsp;<td class="clm3">'Scriptlet' tag, for control-flow, no output <tr>
<td class="clm1"><td class="clm2"> &lt;%_ &nbsp;&nbsp;<td class="clm3">‘Whitespace Slurping’ Scriptlet tag, strips all whitespace before it <tr>
<td class="clm1"><td class="clm2"> &lt;%= &nbsp;&nbsp;<td class="clm3">Outputs the value into the template (HTML escaped) <tr>
<td class="clm1"><td class="clm2"> &lt;%- &nbsp;&nbsp;<td class="clm3">Outputs the unescaped value into the template <tr>
<td class="clm1"><td class="clm2"> &lt;%# &nbsp;&nbsp;<td class="clm3"> :Comment tag, no execution, no output <tr>
<td class="clm1"><td class="clm2"> &lt;%% &nbsp;&nbsp;<td class="clm3">Outputs a literal '&lt;%' &nbsp;&nbsp;&nbsp;&nbsp;<tr>
<td class="clm1"><td class="clm2"> %&gt; &nbsp;&nbsp;&nbsp;<td class="clm3">Plain ending tag &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<tr>
<td class="clm1"><td class="clm2"> -%&gt; &nbsp;&nbsp;<td class="clm3">Trim-mode ('newline slurp') tag, trims following newline <tr>
<td class="clm1"><td class="clm2"> _%&gt; &nbsp;&nbsp;<td class="clm3">‘Whitespace Slurping’ ending tag, removes all whitespace after it <tr>
</tbody></table>
<a name="toc-1-5-9-2"></a><h4>ejs function :</h4>
<table class="markdown"><thead><th class="row"><th class="row">function &nbsp;&nbsp;<th class="row"> description &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<tr>
</thead><tbody><td class="clm1"><td class="clm2"> inclueds &nbsp;<td class="clm3"> Includes are relative to the template with the include call. (This requires the 'filename' option.) For example if you have "./views/users.ejs" and "./views/user/show.ejs" you would use<br> &lt;%- include('user/show'); %&gt;.<tr>
</tbody></table>
<pre>&lt;%- include('user/show', {user: user}); %&gt;
</pre>

<a name="toc-1-5-9-3"></a><h4>ejs layout :</h4>
<ul><li>sample
</ul>
<pre>&lt;%- include('header'); -%&gt;
&lt;h1&gt;
  Title
&lt;/h1&gt;
&lt;p&gt;
  My page
&lt;/p&gt;
&lt;%- include('footer'); -%&gt;
</pre>

<a name="toc-1-5-9-4"></a><h4>express-ejs-layout function :</h4>
<table class="markdown"><thead><th class="row"><th class="row">function &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<th class="row"> description &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<tr>
</thead><tbody><td class="clm1"><td class="clm2"> contentFor &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<td class="clm3"> set contents for target variable <tr>
<td class="clm1"><td class="clm2"> defineContent &nbsp;&nbsp;<td class="clm3"> define target variable &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<tr>
<td class="clm1"><td class="clm2"> &lt;$- variable %&gt; <td class="clm3"> define target variable &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<tr>
</tbody></table>
<a name="toc-1-5-10"></a><h3>npm install express-ejs-layouts :</h3>

<pre>PS G:\workspace\nodejs\ejsboots&gt; npm install express-ejs-layouts
<li>+ express-ejs-layouts@2.5.0
updated 1 package and audited 142 packages in 1.553s
found 0 vulnerabilities

</pre>

<a name="toc-1-5-11"></a><h3>configure layouts and modify index.ejs :</h3>

<ul><li><p>views/includes/_layout.ejsに、bootstrapのサンプルを分解して、Layout化する。<br>

</p><li><p>sample
</p><li>layout : views/includes/_layout.ejs
</ul><pre>&lt;!DOCTYPE html&gt;
&lt;html lang="en"&gt;

&lt;head&gt;

  &lt;meta charset="utf-8"&gt;
  &lt;meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"&gt;
  &lt;meta name="description" content=""&gt;
  &lt;meta name="author" content=""&gt;
  
  &lt;title&gt;&lt;%- defineContent('title') %&gt;&lt;/title&gt;
  
  &lt;link href="vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet" id="ref-css"&gt;
  &lt;link href="css/simple-sidebar.css" rel="stylesheet"&gt;
  
  &lt;%- style %&gt;
  
&lt;/head&gt;

&lt;body&gt;
  
  &lt;%- include('_navi') %&gt;
  
  &lt;!-- /#wrapper :--&gt;
  &lt;div class="d-flex" id="wrapper"&gt;
    &lt;%- include('_sidemenu') %&gt;
    &lt;%- header %&gt;
    
    &lt;!-- body --&gt;
    &lt;%- body %&gt;
    
    
  &lt;/div&gt;
  &lt;!-- /#wrapper :--&gt;
  
  &lt;footer&gt;
    &lt;%- include('_footer') %&gt;
    &lt;%- defineContent('footer') %&gt;
  &lt;/footer&gt;
  
  &lt;%- script %&gt;
  
  &lt;!-- Bootstrap core JavaScript --&gt;
  &lt;script src="vendor/jquery/js/jquery.min.js"&gt;&lt;/script&gt;
  &lt;script src="vendor/bootstrap/js/bootstrap.bundle.min.js"&gt;&lt;/script&gt;
  
  &lt;!-- Menu Toggle Script --&gt;
  &lt;script&gt;
    $("#menu-toggle").click(function(e) {
      e.preventDefault();
      $("#wrapper").toggleClass("toggled");
    });
  &lt;/script&gt;
  
&lt;/body&gt;

&lt;/html&gt;

</pre>
<ul><li>view : views/index.ejs
</ul><pre>&lt;!-- styles --&gt;
&lt;style&gt;
&lt;/style&gt;

&lt;!-- Page Content --&gt;
&lt;div id="page-content-wrapper"&gt;
  &lt;div class="container-fluid"&gt;
    &lt;!-- my content --&gt;
    
    &lt;h1&gt;&lt;%= title %&gt;&lt;/h1&gt;
    &lt;p&gt;Welcome to &lt;%= title %&gt;&lt;/p&gt;
    
    &lt;!-- my content --&gt;
  &lt;/div&gt;
&lt;/div&gt;


&lt;!-- scripts --&gt;
&lt;script&gt;
  // Script content!
&lt;/script&gt;

&lt;% /** title, header and footer **/ %&gt;
&lt;%- contentFor('title') %&gt;
&lt;%= title %&gt;

&lt;%- contentFor('header') %&gt;

&lt;%- contentFor('footer') %&gt;
</pre>

<ul><li>and deploy partials and modify error.ejs
</ul>
<a name="toc-1-5-12"></a><h3>modify app.js :</h3>
<ul><li>app.js
</ul>
<pre>var createError = require('http-errors');
var express = require('express');
var expressLayouts = require('express-ejs-layouts'); // add

var path = require('path');
var cookieParser = require('cookie-parser');
var logger = require('morgan');

var indexRouter = require('./routes/index');
var usersRouter = require('./routes/users');

var app = express();

// view engine setup
app.set('views', path.join(__dirname, 'views'));
app.set('view engine', 'ejs');
app.set('layout extractScripts', true);   // add
app.set('layout extractStyles', true);    // add
app.set('layout', 'includes/_layout');    // add
app.use(expressLayouts);                  // add

app.use(logger('dev'));
app.use(express.json());
app.use(express.urlencoded({ extended: false }));
app.use(cookieParser());
app.use(express.static(path.join(__dirname, 'public')));

app.use('/', indexRouter);
app.use('/users', usersRouter);

// catch 404 and forward to error handler
app.use(function(req, res, next) {
  next(createError(404));
});

// error handler
app.use(function(err, req, res, next) {
  // set locals, only providing error in development
  res.locals.message = err.message;
  res.locals.error = req.app.get('env') === 'development' ? err : {};

  // render the error page
  res.status(err.status || 500);
  res.render('error');
});

module.exports = app;
</pre>
<a name="toc-1-5-13"></a><h3>confirmation :</h3>
<ul><li>access http://localhost:3000<br>
<img src="https://gyazo.com/350bf4e751d70e5b1c2e627f0f1bbf8b.png" alt="image">
</ul>
<a name="toc-1-6"></a><h2>summary :</h2>
<ul><li>create a express project with ejs template.
<li>set index.html from bootstrap template site.
<li>modify site pages with bootstrap template using ejs template engine.
</ul><br>
<hr>Output by WZ Markdown Editor (Trial)<br></div>
</body>
</html>
